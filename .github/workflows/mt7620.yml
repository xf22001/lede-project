name: miwifi-r3 compile

on:
  workflow_dispatch:

jobs:
  build-and-upload:
    name: Compile and Upload
    runs-on: ubuntu-20.04  # 指定运行器环境

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2  # 检出你的代码到运行器

      # 配置缓存步骤
      - name: Cache dependencies
        uses: actions/cache@v2
        with:
          path: |
            ./build_dir
            ./staging_dir/
          key: ${{ runner.os }}-build-${{ hashFiles('**/staging_dir/toolchain-mipsel_24kc_gcc-13.2.0_musl/info.mk') }}
          restore-keys: |
            ${{ runner.os }}-build-

      - name: Set up Permissions for compile.sh
        run: chmod +x ./compile.sh  # 确保脚本具有执行权限

      - name: Execute compile.sh
        run: ./compile.sh  # 执行脚本

      - name: Upload Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: firmware-binaries  # 构件的名称
          path: ./bin/targets/ramips/mt7620/*  # 指定要上传的文件或目录的路径
